<!DOCTYPE html>
<html>
	<head>
		<title>{% block title %}Winfly 快速共享你的文件{% endblock title %}</title>
		<meta name='description' content='{% block description %}winfly 快速共享你的文件。在一台电脑安装之后其他电脑或手机就可以通过浏览器访问你共享的文件了。视频文件还可以在线播放哦。{% endblock description %}'>
		<meta name="keywords" content="文件共享 手机在线视频 手机电脑文件共享 私有云 文件服务器 比ftp更易用">
		<meta name="baidu-site-verification" content="Bg6z5YVQKp" />
		<meta name="google-site-verification" content="r6nppR-ZGe657oLXtCGYMtBLkt5Bk8f_A0LlkPATjy8" />
		<link rel="icon" href="/static/img/logo.jpg" type="image/x-icon" />
		<link rel="shortcut icon" href="/static/img/logo.jpg" type="image/x-icon" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link rel="apple-touch-icon" sizes="114x114" href="/static/img/touch-icon-114x114.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="/static/img/touch-icon-72x72.png" />
		<link rel="apple-touch-icon" href="/static/img/touch-icon-iphone.png" />
		
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114.png" />
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72.png" />
		<link rel="apple-touch-icon-precomposed" href="/static/img/touch-icon-iphone.png" />
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel='stylesheet' href='/static/css/font-awesome-4.0.3/css/font-awesome.css'>
		<link rel='stylesheet' href='/static/css/bootstrap-3.0.3-dist/dist/css/bootstrap.min.css'>
		<link rel='stylesheet' href='/static/css/bootstrap-3.0.3-dist/dist/css/bootstrap-theme.min.css'>
		<link rel='stylesheet' href='/static/css/Stashy/Stashy.min.css'>
		<link rel='stylesheet' href='/static/css/pages.css'>
		<link rel='stylesheet' href='/static/css/style.css'>
		<script src='/static/js/jquery-1.10.2.min.js'></script>
		<script src='/static/js/juicer.js'></script>
		<script src='/static/js/bootstrap-3.0.3-dist/dist/js/bootstrap.min.js'></script>
		<script src='/static/js/Stashy/Stashy.min.js'></script>
		<script src='/static/js/history.js'></script>
		<script src='/static/js/jquery.hotkeys.js'></script>
		<script src='/static/js/bootstrap-wysiwyg.js'></script>
		
	</head>
	
	<body {% block body %}{% endblock body %}>
		<div>
			<div style='background-color: rgb(26, 212, 93);margin-top:50px;'>
				<div class="navbar navbar-inverse navbar-fixed-top hidden-print">
					<div class="container">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
								<span class="sr-only">Toggle navigation</span>
								<i class="fa fa-bars fa-lg"></i>
							</button>
							<a style='color:white;' class="navbar-brand" href="/doc"><i class="fa fa-rocket"></i> Winfly</a>
						</div>
						<div class="navbar-collapse collapse">
							<ul class="nav navbar-nav">
								<li class="{% block homeClass %}{% endblock homeClass %}"><a href="/doc">主页</a></li>
								<li class="{% block getStartedClass %}{% endblock getStartedClass %}"><a href="/getStarted">开始使用</a></li>
								<li class="{% block manualClass %}{% endblock manualClass %}"><a href="/manual">用户手册</a></li>
								<li class="{% block communityClass %}{% endblock communityClass %}"><a href="/community">社区</a></li>
								<li class="{% block licenseClass %}{% endblock licenseClass %}"><a href="/license">版权协议</a></li>
								<li class="{% block aboutClass %}{% endblock aboutClass %}"><a href="/about">关于我们</a></li>
							</ul>
							{% if CommunityPage %}
							<ul class="nav navbar-nav navbar-right">
								<li><a href="#" onclick='login();return false;'>登陆</a></li>
								<li><a href="#" onclick='register();return false;'>注册</a></li>
							</ul>
							{% endif %}
						</div>
					</div>
				</div>
				{% block header %}{% endblock header %}
			</div>
			<div class='container'>
				{% block content %}{% endblock content %}
				{% block editor %}{% endblock editor %}
			</div>
		{% block loginPage %}
		
<div class="modal fade" id="login.modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">登录</h4>
      </div>
      <div class="modal-body">
			<form class="form-horizontal" role="form">
				<div class="form-group">
					<div class="col-sm-10">
					<input id='login.username' type="text" class="form-control"  placeholder="用户名">
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-10">
					<input id='login.password' type="password" class="form-control" id="inputPassword3" placeholder="密码">
					</div>
				</div>
			</form>
      </div>
      <div class="modal-footer">
		<i class='fa fa-spinner fa-spin fa-4x pull-left hide' id='login.spinner'></i>
        <button type="button" class="btn btn-primary" onclick='login.send()'>登录</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
      </div>
    </div>
  </div>
</div>

<script>
	
	function login(){
		$('#login\\.modal').modal();
		login.send = function(){
			var username = $('#login\\.username').val();
			var password = $('#login\\.password').val();
			//check valid
			$('#login\\.spinner').removeClass('hide');
			$.post('/login',{
				username:username,
				password:password,
				csrfmiddlewaretoken:"{{csrf_token}}",
			},function(data){
				$('#login\\.spinner').addClass('hide');
				if(data.message == 'OK'){
					myNotify("成功",'你已经成功登陆');
					$('#login\\.modal').modal('hide');
					serverData.user = data.user;
					console.log(serverData.user);
					updateView();
				}else{
					myNotify("错误","用户名或密码错误");
				}
			})
		}
	}
	
	function logout(){
		$.post('/logout',{
			csrfmiddlewaretoken:"{{csrf_token}}",
		},function(data){
			if(data.message == "OK"){
				//clear server data
				serverData.user = '';
				updateView();
			}
		})
	}
</script>
{% endblock loginPage %}

{% block registerPage %}
<div class="modal fade" id="register.modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">注册</h4>
      </div>
      <div class="modal-body">
			<form class="form-horizontal" role="form">
				<div class="form-group">
					<div class="col-sm-10">
					<input id='register.username' type="text" class="form-control"  placeholder="用户名">
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-10">
					<input id='register.password' type="password" class="form-control" id="inputPassword3" placeholder="密码">
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-10">
					<input id='register.repassword' type="password" class="form-control" id="inputPassword3" placeholder="重复密码">
					</div>
				</div>
			</form>
      </div>
      <div class="modal-footer">
		<i class='fa fa-spinner fa-spin fa-4x pull-left hide' id='register.spinner'></i>
        <button type="button" class="btn btn-primary" onclick='register.send()'>注册</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
      </div>
    </div>
  </div>
</div>


<script>
	function register(){
		$('#register\\.modal').modal();
		register.send = function(){
			var username = $('#register\\.username').val();
			var password = $('#register\\.password').val();
			var repassword = $('#register\\.repassword').val();
			
			var csrf_token = "{{csrf_token}}";
			
			//check valid
			if(username == '' || password == ''){
				myNotify('提示','用户名或密码不能为空');
				return false;
			}
			var pattern = /^[A-Za-z0-9\u4e00-\u9fa5\s]+$/g
			if( !pattern.test(username)){
				myNotify('提示','用户名只能是英文字符或者汉字');
				return false;
			}
			if(password != repassword){
				myNotify("错误","两次输入的密码不一致");
				return false;
			}
			
			$('#register\\.spinner').removeClass('hide');
			$.post('/register',{
				username:username,
				password:password,
				csrfmiddlewaretoken:csrf_token,
			},function(data){
				$('#register\\.spinner').addClass('hide');
				if(data.message == "OK"){
					$('#register\\.modal').modal('hide');
					myNotify('成功','你已经注册成功');
					//call update view here
					serverData.user = {
						name:data.user.name,
						id:data.user.id,
					}
				}
				else if(data.message == 'Error' && data.reason == 'nameRepeat'){
					myNotify('错误','这个用户已被注册');
				}
				else{
					myNotify('错误','用户注册失败');
				}
			})
		}
	}
</script>
{% endblock registerPage %}

		</div>
		{% block footer %}
			<div class="fullSize" style="height:100px;text-align:center;margin-top:50px;">
				<hr>
				<small>Copyright Shareyan.com All rights reserved. <a style='color:black;text-decoration:none;' href="http://www.miibeian.gov.cn">京ICP备13029912号</a></small>
				<br><small>联系电话:15655430787</small>
			</div>
		{% endblock footer %}
		
		<a href='#top' class='toTop' title='回到顶部' ><i class='fa fa-arrow-circle-o-up fa-3x'></i></a>
		<script>
			function myNotify(title,content){
				Stashy.Notify({
					title : title,
					content : content,
					titleSize : 4,
					style : "default",
					contentType : "inline",
					animDuration : "fast",
					closeArea : "element"
				}).toast("right", "top", true);
			}
			
			$("a[href='#top']").click(function() {
				$("html, body").animate({ scrollTop: 0 }, 'slow');
				return false;
			});
			
			$(document).ready(function(){
				console.log($(document).height(),$(window).height());
				if($(document).height() <= $(window).height()){
					$("a[href='#top']").css('display','none');
				}
			})
			
		</script>
	</body>
</html>